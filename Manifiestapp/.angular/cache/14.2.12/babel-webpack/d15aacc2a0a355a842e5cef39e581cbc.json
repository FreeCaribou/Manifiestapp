{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { NavigationEnd } from '@angular/router';\nimport { forkJoin } from 'rxjs';\nimport { filter } from 'rxjs/operators';\nimport { LocalStorageEnum } from '../../models/LocalStorage.enum';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../services/data/selling/selling.service\";\nimport * as i4 from \"../../services/communication/loading.communication.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@ngx-translate/core\";\nfunction SellerDepartmentInfoModalComponent_ion_item_11_ion_select_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-select-option\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const d_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", d_r3.code);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(d_r3.label);\n  }\n}\nfunction SellerDepartmentInfoModalComponent_ion_item_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\", 11);\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-select\", 12);\n    i0.ɵɵlistener(\"ionChange\", function SellerDepartmentInfoModalComponent_ion_item_11_Template_ion_select_ionChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.onSellerDepartementChange($event));\n    });\n    i0.ɵɵpipe(5, \"translate\");\n    i0.ɵɵtemplate(6, SellerDepartmentInfoModalComponent_ion_item_11_ion_select_option_6_Template, 2, 2, \"ion-select-option\", 13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(3, 4, \"Ticket.Department\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"placeholder\", i0.ɵɵpipeBind1(5, 6, \"Ticket.DepartmentChoice\"))(\"value\", ctx_r0.sellerDepartement);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.departements);\n  }\n}\nfunction SellerDepartmentInfoModalComponent_ion_item_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"translate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-toggle\", 15);\n    i0.ɵɵlistener(\"ionChange\", function SellerDepartmentInfoModalComponent_ion_item_12_Template_ion_toggle_ionChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.onSellerFromWorkGroup($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(3, 2, \"Ticket.IAmFromWorkerGroup\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"checked\", ctx_r1.sellerFromWorkGroup);\n  }\n}\n// TODO go to real form\nexport let SellerDepartmentInfoModalComponent = /*#__PURE__*/(() => {\n  class SellerDepartmentInfoModalComponent {\n    constructor(modalController, router, sellingService, loadingCommunication) {\n      this.modalController = modalController;\n      this.router = router;\n      this.sellingService = sellingService;\n      this.loadingCommunication = loadingCommunication;\n      this.departements = [];\n      this.provinces = [];\n    }\n    get infoOk() {\n      return this.sellerDepartement && this.sellerPostalCode && this.sellerSellingGoal;\n    }\n    ngOnInit() {\n      this.loadingCommunication.changeLoaderTo(true);\n      forkJoin([this.sellingService.getAllDepartments(), this.sellingService.getAllProvinceInfo()]).subscribe(d => {\n        this.departements = d[0];\n        this.provinces = d[1];\n        this.verifyData();\n      }).add(() => {\n        this.loadingCommunication.changeLoaderTo(false);\n      });\n      this.router.events.pipe(filter(event => event instanceof NavigationEnd)).subscribe(r => {\n        this.closeShowAfterSellingModal();\n      });\n    }\n    verifyData() {\n      this.sellerDepartement = localStorage.getItem(LocalStorageEnum.SellerDepartment);\n      this.sellerPostalCode = localStorage.getItem(LocalStorageEnum.SellerPostalCode);\n      this.sellerSellingGoal = parseInt(localStorage.getItem(LocalStorageEnum.SellerSellingGoal));\n      this.sellerFromWorkGroup = localStorage.getItem(LocalStorageEnum.SellerFromWorkGroup);\n    }\n    ok() {\n      var _a;\n      localStorage.setItem(LocalStorageEnum.SellerSellingGoal, this.sellerSellingGoal.toString());\n      localStorage.setItem(LocalStorageEnum.SellerDepartment, this.sellerDepartement);\n      localStorage.setItem(LocalStorageEnum.SellerPostalCode, this.sellerPostalCode);\n      if (this.sellerFromWorkGroup) {\n        localStorage.setItem(LocalStorageEnum.SellerFromWorkGroup, 'true');\n      } else {\n        localStorage.removeItem(LocalStorageEnum.SellerFromWorkGroup);\n      }\n      (_a = this.modalController) === null || _a === void 0 ? void 0 : _a.dismiss();\n    }\n    closeShowAfterSellingModal() {\n      var _a;\n      return __awaiter(this, void 0, void 0, function* () {\n        const modal = yield this.modalController.getTop();\n        if (modal) {\n          (_a = this.modalController) === null || _a === void 0 ? void 0 : _a.dismiss();\n        }\n      });\n    }\n    // TODO verification real post code of check with the department\n    onSellerDepartementChange(event) {\n      var _a, _b, _c;\n      if ((_a = event.detail) === null || _a === void 0 ? void 0 : _a.value) {\n        this.sellerDepartement = (_b = event.detail) === null || _b === void 0 ? void 0 : _b.value;\n        if (((_c = event.detail) === null || _c === void 0 ? void 0 : _c.value) !== 'BASE') {\n          this.sellerFromWorkGroup = undefined;\n        }\n      } else {\n        this.sellerDepartement = undefined;\n      }\n    }\n    onSellerPostalCodeChange(event) {\n      var _a;\n      const postalCode = (_a = event.detail) === null || _a === void 0 ? void 0 : _a.value;\n      if (!!postalCode) {\n        const province = this.provinces.find(p => {\n          var _a;\n          return (_a = p.ranges) === null || _a === void 0 ? void 0 : _a.find(r => {\n            return r.start <= postalCode && r.end >= postalCode;\n          });\n        });\n        if (province) {\n          this.sellerPostalCode = postalCode;\n        } else {\n          this.sellerPostalCode = undefined;\n        }\n      } else {\n        this.sellerPostalCode = undefined;\n      }\n    }\n    onSellerFromWorkGroup(event) {\n      var _a;\n      if ((_a = event.detail) === null || _a === void 0 ? void 0 : _a.checked) {\n        this.sellerFromWorkGroup = 'true';\n      } else {\n        this.sellerFromWorkGroup = undefined;\n      }\n    }\n    onSellerSellingGoal(event) {\n      var _a;\n      const sellingGoal = (_a = event.detail) === null || _a === void 0 ? void 0 : _a.value;\n      if (isNaN(sellingGoal)) {\n        this.sellerSellingGoal = undefined;\n      } else {\n        if (!!sellingGoal) {\n          this.sellerSellingGoal = sellingGoal;\n        } else {\n          this.sellerSellingGoal = undefined;\n        }\n      }\n    }\n  }\n  SellerDepartmentInfoModalComponent.ɵfac = function SellerDepartmentInfoModalComponent_Factory(t) {\n    return new (t || SellerDepartmentInfoModalComponent)(i0.ɵɵdirectiveInject(i1.ModalController), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.SellingService), i0.ɵɵdirectiveInject(i4.LoadingCommunicationService));\n  };\n  SellerDepartmentInfoModalComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SellerDepartmentInfoModalComponent,\n    selectors: [[\"app-seller-department-info-modal\"]],\n    decls: 32,\n    vars: 30,\n    consts: [[3, \"translucent\"], [\"color\", \"primary\"], [2, \"display\", \"flex\", \"justify-content\", \"center\"], [1, \"ion-padding\"], [4, \"ngIf\"], [\"color\", \"primary\", \"position\", \"stacked\"], [\"type\", \"number\", 3, \"placeholder\", \"value\", \"ionChange\"], [\"type\", \"number\", \"min\", \"0\", 3, \"placeholder\", \"value\", \"ionChange\"], [\"color\", \"success\", \"expand\", \"block\", 1, \"m-top-medium\", 3, \"disabled\", \"click\"], [\"name\", \"checkmark-circle-outline\"], [\"color\", \"danger\", \"expand\", \"block\", 1, \"m-top-medium\", 3, \"click\"], [\"color\", \"primary\", \"position\", \"floating\"], [\"interface\", \"popover\", 3, \"placeholder\", \"value\", \"ionChange\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [\"slot\", \"end\", 3, \"checked\", \"ionChange\"]],\n    template: function SellerDepartmentInfoModalComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\", 1)(2, \"ion-buttons\", 2)(3, \"ion-button\");\n        i0.ɵɵtext(4);\n        i0.ɵɵpipe(5, \"translate\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(6, \"ion-content\", 3);\n        i0.ɵɵelementContainerStart(7);\n        i0.ɵɵelementStart(8, \"p\");\n        i0.ɵɵtext(9);\n        i0.ɵɵpipe(10, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(11, SellerDepartmentInfoModalComponent_ion_item_11_Template, 7, 8, \"ion-item\", 4);\n        i0.ɵɵtemplate(12, SellerDepartmentInfoModalComponent_ion_item_12_Template, 5, 4, \"ion-item\", 4);\n        i0.ɵɵelementStart(13, \"ion-item\")(14, \"ion-label\", 5);\n        i0.ɵɵtext(15);\n        i0.ɵɵpipe(16, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"ion-input\", 6);\n        i0.ɵɵlistener(\"ionChange\", function SellerDepartmentInfoModalComponent_Template_ion_input_ionChange_17_listener($event) {\n          return ctx.onSellerPostalCodeChange($event);\n        });\n        i0.ɵɵpipe(18, \"translate\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(19, \"ion-item\")(20, \"ion-label\", 5);\n        i0.ɵɵtext(21);\n        i0.ɵɵpipe(22, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"ion-input\", 7);\n        i0.ɵɵlistener(\"ionChange\", function SellerDepartmentInfoModalComponent_Template_ion_input_ionChange_23_listener($event) {\n          return ctx.onSellerSellingGoal($event);\n        });\n        i0.ɵɵpipe(24, \"translate\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementContainerEnd();\n        i0.ɵɵelementStart(25, \"ion-button\", 8);\n        i0.ɵɵlistener(\"click\", function SellerDepartmentInfoModalComponent_Template_ion_button_click_25_listener() {\n          return ctx.ok();\n        });\n        i0.ɵɵtext(26);\n        i0.ɵɵpipe(27, \"translate\");\n        i0.ɵɵelement(28, \"ion-icon\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"ion-button\", 10);\n        i0.ɵɵlistener(\"click\", function SellerDepartmentInfoModalComponent_Template_ion_button_click_29_listener() {\n          return ctx.closeShowAfterSellingModal();\n        });\n        i0.ɵɵtext(30);\n        i0.ɵɵpipe(31, \"translate\");\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"translucent\", true);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(5, 14, \"Ticket.MyDepartmentInfo\"));\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(10, 16, \"Ticket.EnterSomeDataToBeAbleToSell\"));\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.departements.length > 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.sellerDepartement === \"BASE\");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(16, 18, \"Volunteer.PostalCode\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"placeholder\", i0.ɵɵpipeBind1(18, 20, \"Volunteer.PostalCode\"))(\"value\", ctx.sellerPostalCode);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(22, 22, \"Volunteer.SellingGoal\"), \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"placeholder\", i0.ɵɵpipeBind1(24, 24, \"Volunteer.SellingGoal\"))(\"value\", ctx.sellerSellingGoal);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"disabled\", !ctx.infoOk);\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(27, 26, \"General.Confirm\"), \" \");\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(31, 28, \"Ticket.Cancel\"), \" \");\n      }\n    },\n    dependencies: [i5.NgForOf, i5.NgIf, i1.IonButton, i1.IonButtons, i1.IonContent, i1.IonHeader, i1.IonIcon, i1.IonInput, i1.IonItem, i1.IonLabel, i1.IonSelect, i1.IonSelectOption, i1.IonToggle, i1.IonToolbar, i1.BooleanValueAccessor, i1.NumericValueAccessor, i1.SelectValueAccessor, i6.TranslatePipe],\n    encapsulation: 2\n  });\n  return SellerDepartmentInfoModalComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}
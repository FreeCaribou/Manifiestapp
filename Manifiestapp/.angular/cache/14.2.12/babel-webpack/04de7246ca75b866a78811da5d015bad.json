{"ast":null,"code":"import { LocalStorageEnum } from '../../models/LocalStorage.enum';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/communication/viva-wallet-verification.communication.service\";\nimport * as i2 from \"@awesome-cordova-plugins/diagnostic/ngx\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@awesome-cordova-plugins/app-availability/ngx\";\nimport * as i5 from \"@awesome-cordova-plugins/open-native-settings/ngx\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@ngx-translate/core\";\nfunction VivaWalletVerificationComponent_h6_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"h6\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementStart(3, \"ion-button\", 1);\n    i0.ɵɵlistener(\"click\", function VivaWalletVerificationComponent_h6_3_Template_ion_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.goInstallVivaWallet());\n    });\n    i0.ɵɵelement(4, \"ion-icon\", 2);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 2, \"Ticket.VivaWalletNotInstall\"), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(6, 4, \"Ticket.InstallVivaWallet\"), \" \");\n  }\n}\nfunction VivaWalletVerificationComponent_h6_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"h6\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementStart(3, \"ion-button\", 1);\n    i0.ɵɵlistener(\"click\", function VivaWalletVerificationComponent_h6_4_Template_ion_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.goActiveGps());\n    });\n    i0.ɵɵelement(4, \"ion-icon\", 3);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 2, \"Ticket.GpsNotActivated\"), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(6, 4, \"Ticket.ActivateGps\"), \" \");\n  }\n}\nfunction VivaWalletVerificationComponent_h6_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"h6\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementStart(3, \"ion-button\", 1);\n    i0.ɵɵlistener(\"click\", function VivaWalletVerificationComponent_h6_5_Template_ion_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.goActiveNfc());\n    });\n    i0.ɵɵelement(4, \"ion-icon\", 4);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"translate\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 2, \"Ticket.NfcNotActivated\"), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(6, 4, \"Ticket.ActivateNfc\"), \" \");\n  }\n}\nfunction VivaWalletVerificationComponent_h6_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"h6\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementStart(3, \"ion-button\", 5);\n    i0.ɵɵlistener(\"click\", function VivaWalletVerificationComponent_h6_6_Template_ion_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.nfcNotAvailableOk());\n    });\n    i0.ɵɵelement(4, \"ion-icon\", 4);\n    i0.ɵɵtext(5, \" Ok \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"Ticket.NoNfcAvailable\"), \" \");\n  }\n}\nfunction VivaWalletVerificationComponent_h6_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"h6\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementStart(3, \"ion-button\", 6);\n    i0.ɵɵlistener(\"click\", function VivaWalletVerificationComponent_h6_7_Template_ion_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.payconicWarningOk());\n    });\n    i0.ɵɵelement(4, \"ion-icon\", 4);\n    i0.ɵɵtext(5, \" Ok \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 1, \"Ticket.PayconicWarning\"), \" \");\n  }\n}\nexport let VivaWalletVerificationComponent = /*#__PURE__*/(() => {\n  class VivaWalletVerificationComponent {\n    constructor(vivaWalletVerification, diagnostic, platform, appAvailability, openSetting) {\n      this.vivaWalletVerification = vivaWalletVerification;\n      this.diagnostic = diagnostic;\n      this.platform = platform;\n      this.appAvailability = appAvailability;\n      this.openSetting = openSetting;\n    }\n    ngOnInit() {\n      this.verifyHardwareForVivaWallet();\n    }\n    ionViewWillEnter() {\n      this.verifyHardwareForVivaWallet();\n    }\n    ngAfterViewInit() {\n      document.addEventListener('visibilitychange', () => {\n        this.verifyHardwareForVivaWallet();\n      });\n    }\n    get knowNfcNotThere() {\n      return localStorage.getItem(LocalStorageEnum.KnowNotNFC);\n    }\n    get knowPayconic() {\n      return localStorage.getItem(LocalStorageEnum.KnowPayconic);\n    }\n    // TODO for IOS\n    verifyNfc() {\n      // If NFC is on the phone, we check if enabled or not\n      // If not present, we act like it is to not block everything because Viva Wallet can manage that too\n      this.diagnostic.isNFCPresent().then(r => {\n        this.vivaWalletVerification.nfcAvailable = r;\n        if (r === true) {\n          this.diagnostic.isNFCEnabled().then(r => {\n            this.vivaWalletVerification.nfcActivated = r;\n          }).catch(e => {\n            this.vivaWalletVerification.nfcActivated = false;\n          });\n        }\n      }).catch(e => {\n        this.vivaWalletVerification.nfcAvailable = false;\n      });\n      // this.diagnostic.isNFCPresent().then(r => {\n      //   this.vivaWalletVerification.nfcAvailable = r;\n      //   if (r) {\n      //     this.diagnostic.isNFCEnabled()\n      //       .then(e => { this.vivaWalletVerification.nfcActivated = true; })\n      //       .catch(e => { this.vivaWalletVerification.nfcActivated = false;& });\n      //   } else {\n      //     this.vivaWalletVerification.nfcActivated = true;\n      //   }\n      // });\n      // if (this.diagnostic.NFCState) {\n      //   this.vivaWalletVerification.nfcAvailable = true;\n      //   this.diagnostic.isNFCPresent().then(r => {\n      //     this.diagnostic.isNFCEnabled()\n      //       .then(e => { this.vivaWalletVerification.nfcActivated = e; })\n      //       .catch(e => { this.vivaWalletVerification.nfcActivated = false; });\n      //   }).then(err => { this.vivaWalletVerification.nfcActivated = true; })\n      // } else {\n      //   this.vivaWalletVerification.nfcActivated = true;\n      //   this.vivaWalletVerification.nfcAvailable = false;\n      // }\n    }\n    // TODO for IOS\n    verifyGps() {\n      this.diagnostic.isGpsLocationEnabled().then(e => {\n        this.vivaWalletVerification.gpsActivated = e;\n      }).catch(e => {\n        this.vivaWalletVerification.gpsActivated = false;\n      });\n    }\n    verifyVivaWallet() {\n      let app = '';\n      if (this.platform.is('android')) {\n        app = 'com.vivawallet.spoc.payapp';\n        this.appAvailability.check(app).then(yes => {\n          this.vivaWalletVerification.vivaWalletInstall = true;\n        }, no => {\n          this.vivaWalletVerification.vivaWalletInstall = false;\n        });\n      }\n      if (this.platform.is('ios')) {\n        app = 'viva-wallet://';\n        this.vivaWalletVerification.vivaWalletInstall = true;\n      }\n    }\n    goInstallVivaWallet() {\n      if (this.platform.is('android')) {\n        window.open('market://details?id=com.vivawallet.spoc.payapp', '_system');\n      }\n      if (this.platform.is('ios')) {\n        window.open('itms-apps://itunes.apple.com/be/app/viva-wallet/id1510538423?mt=8', '_system');\n      }\n    }\n    goActiveGps() {\n      if (this.platform.is('android')) {\n        this.diagnostic.switchToLocationSettings();\n      }\n      if (this.platform.is('ios')) {\n        this.openSetting.open('locations');\n      }\n    }\n    goActiveNfc() {\n      if (this.platform.is('android')) {\n        this.diagnostic.switchToNFCSettings();\n      }\n      if (this.platform.is('ios')) {\n        this.openSetting.open('settings');\n      }\n    }\n    nfcNotAvailableOk() {\n      localStorage.setItem(LocalStorageEnum.KnowNotNFC, 'true');\n    }\n    payconicWarningOk() {\n      localStorage.setItem(LocalStorageEnum.KnowPayconic, 'true');\n    }\n    verifyHardwareForVivaWallet() {\n      this.verifyVivaWallet();\n      this.verifyGps();\n      this.verifyNfc();\n      this.diagnostic.registerNFCStateChangeHandler(() => {\n        this.verifyNfc();\n      });\n      this.diagnostic.registerLocationStateChangeHandler(() => {\n        this.verifyGps();\n      });\n    }\n  }\n  VivaWalletVerificationComponent.ɵfac = function VivaWalletVerificationComponent_Factory(t) {\n    return new (t || VivaWalletVerificationComponent)(i0.ɵɵdirectiveInject(i1.VivaWalletVerificationCommunicationService), i0.ɵɵdirectiveInject(i2.Diagnostic), i0.ɵɵdirectiveInject(i3.Platform), i0.ɵɵdirectiveInject(i4.AppAvailability), i0.ɵɵdirectiveInject(i5.OpenNativeSettings));\n  };\n  VivaWalletVerificationComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: VivaWalletVerificationComponent,\n    selectors: [[\"app-viva-wallet-verification\"]],\n    decls: 8,\n    vars: 8,\n    consts: [[4, \"ngIf\"], [\"expand\", \"block\", 3, \"click\"], [\"name\", \"cloud-download-outline\"], [\"name\", \"location\"], [\"name\", \"card\"], [\"expand\", \"block\", \"color\", \"success\", 3, \"click\"], [\"expand\", \"block\", \"color\", \"warning\", 3, \"click\"]],\n    template: function VivaWalletVerificationComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h5\");\n        i0.ɵɵtext(1);\n        i0.ɵɵpipe(2, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(3, VivaWalletVerificationComponent_h6_3_Template, 7, 6, \"h6\", 0);\n        i0.ɵɵtemplate(4, VivaWalletVerificationComponent_h6_4_Template, 7, 6, \"h6\", 0);\n        i0.ɵɵtemplate(5, VivaWalletVerificationComponent_h6_5_Template, 7, 6, \"h6\", 0);\n        i0.ɵɵtemplate(6, VivaWalletVerificationComponent_h6_6_Template, 6, 3, \"h6\", 0);\n        i0.ɵɵtemplate(7, VivaWalletVerificationComponent_h6_7_Template, 6, 3, \"h6\", 0);\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(2, 6, \"Ticket.HardwareNOK\"), \"\\n\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", !ctx.vivaWalletVerification.vivaWalletInstall);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.vivaWalletVerification.gpsActivated);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.vivaWalletVerification.nfcActivated && ctx.vivaWalletVerification.nfcAvailable);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.vivaWalletVerification.nfcAvailable && !ctx.knowNfcNotThere);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.knowPayconic);\n      }\n    },\n    dependencies: [i6.NgIf, i3.IonButton, i3.IonIcon, i7.TranslatePipe],\n    encapsulation: 2\n  });\n  return VivaWalletVerificationComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}
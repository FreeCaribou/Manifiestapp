<app-header [title]="'Selling'" *ngIf="!showClientDetailForm"></app-header>

<ion-header *ngIf="showClientDetailForm">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="cancelBuy()">{{"Ticket.Cancel" | translate}}</ion-button>
    </ion-buttons>
    <ion-title>{{'Ticket.Details' | translate}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ng-container *ngIf="!showClientDetailForm">

    <ng-container *ngIf="!seller || !volunteerShiftService.isReadyToSellWithData()">
      <a [routerLink]="['/my-manifiesta']">
        <h6 class="m-right-medium m-left-medium m-bt-medium m-top-medium">{{'Ticket.GoMyManifiestaForConnect' |
          translate}}</h6>
      </a>
      <!-- <form *ngIf="loginForm" [formGroup]="loginForm">

        <h3 class="m-right-medium m-left-medium">
          {{'Ticket.ConnectionSelling' | translate}}
        </h3>

        <ion-grid>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.SellerEmail" | translate}}
                </ion-label>
                <ion-input clearInput type="email" formControlName="email" required placeholder="email@something.be">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="floating">
                  {{"Ticket.Department" | translate}}
                </ion-label>
                <ion-select [placeholder]="'Ticket.DepartmentChoice' | translate" formControlName="department"
                  interface="popover">
                  <ion-select-option *ngFor="let d of departments" [value]="d.id">{{d.label}}</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-button class="padding-not-stick-edges" (click)="clickOnLogin()" color="secondary" expand="block"
                [disabled]="!loginForm.valid">
                {{'User.Login' | translate}}
                <ion-icon slot="end" icon="person"></ion-icon>
                <ion-icon slot="end" icon="ticket"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>

          <p *ngIf="hadLoginError" class="m-right-medium m-left-medium">{{'User.ConnectionProblem' | translate}}</p>

        </ion-grid>
      </form> -->
    </ng-container>

    <!-- If connected -->
    <div *ngIf="seller && volunteerShiftService.isReadyToSellWithData()" class="m-right-medium m-left-medium">

      <ng-container *ngIf="mySellingInfo">
        <h2>
          {{'Ticket.TicketsGoal' | translate}} {{mySellingInfo?.totalAmountTicket}} / {{sellerSellingGoal}}
        </h2>
        <ion-progress-bar [value]="progress" color="danger"></ion-progress-bar>
      </ng-container>

      <ng-container *ngIf="allHardwareOk">
        <ion-card *ngFor="let ticketType of ticketTypes; let index = index" color="secondary">
          <ion-card-header>
            <ion-card-title>{{ticketType.name}} - {{ticketType.description}}</ion-card-title>
            <ion-card-subtitle>{{ticketType.price + ticketType.fee | currency:'EUR'}}</ion-card-subtitle>
          </ion-card-header>
          <ion-item>
            <ion-button slot="start" [disabled]="ticketNumberOfSell[index].ticketAmount <= 0"
              (click)="changeAmountTicket(index, 'remove')">
              <ion-icon name="remove"></ion-icon>
            </ion-button>
            <ion-input [(ngModel)]="ticketNumberOfSell[index].ticketAmount" type="number" min="0"></ion-input>
            <ion-label>
              | {{ticketNumberOfSell[index].ticketPrice *
              ticketNumberOfSell[index].ticketAmount |
              currency:'EUR'}}
            </ion-label>
            <ion-button slot="end" (click)="changeAmountTicket(index, 'add')">
              <ion-icon name="add"></ion-icon>
            </ion-button>
          </ion-item>
        </ion-card>

        <ion-button class="m-top-medium" [disabled]="totalAmount <= 0 || !allHardwareOk" color="secondary"
          expand="block" (click)="setOpenModal(true)">
          <ion-icon name="cart"></ion-icon>
          {{"Ticket.Buy" | translate}} {{totalAmount | currency:'EUR'}}
        </ion-button>
      </ng-container>

      <!-- <br>
      <ion-button class="m-top-medium" (click)="autoVivaWalletAuth()" expand="block">
        Test Auto Viva Wallet Auth
      </ion-button> -->

      <ng-container *ngIf="!allHardwareOk">
        <h2>
          {{"Ticket.HardwareNOK" | translate}}
        </h2>
        <h3 *ngIf="!vivaWalletInstall">
          {{"Ticket.VivaWalletNotInstall" | translate}}
          <ion-button expand="block" (click)="goInstallVivaWallet()">
            <ion-icon name="cloud-download-outline"></ion-icon>
            {{"Ticket.InstallVivaWallet" | translate}}
          </ion-button>
        </h3>
        <!-- <h3 *ngIf="!bluetoothActivated">
          {{"Ticket.BluetoothNotActivated" | translate}}
          <ion-button expand="block" (click)="goActiveBluetooth()">
            <ion-icon name="bluetooth"></ion-icon>
            {{"Ticket.ActivateBluetooth" | translate}}
          </ion-button>
        </h3> -->
        <h3 *ngIf="!gpsActivated">
          {{"Ticket.GpsNotActivated" | translate}}
          <ion-button expand="block" (click)="goActiveGps()">
            <ion-icon name="location"></ion-icon>
            {{"Ticket.ActivateGps" | translate}}
          </ion-button>
        </h3>
        <h3 *ngIf="!nfcActivated">
          {{"Ticket.NfcNotActivated" | translate}}
          <ion-button expand="block" (click)="goActiveNfc()">
            <ion-icon name="card"></ion-icon>
            {{"Ticket.ActivateNfc" | translate}}
          </ion-button>
        </h3>
      </ng-container>
    </div>

    <!-- <ion-button color="danger" (click)="clickOnLogout()" expand="block">
      Logout <ion-icon name="log-out-outline"></ion-icon>
    </ion-button> -->


    <!-- JUST FOR TEST COMMENT BEFORE RELEASE -->
    <!-- <div>
      {{routerUrl}}
  
      {{status}}
  
      {{message}}
    </div> -->
  </ng-container>

  <!-- *ngIf="showClientDetailForm" -->
  <ng-container *ngIf="showClientDetailForm && buyForm && addressForm">
    <ion-content class="ion-padding">
      <ng-container>
        <h4>
          {{"Ticket.TicketBuyRecap" | translate}}
        </h4>
        <p *ngFor="let t of recapSelectedTicket">
          {{t.ticketAmount}}x {{t.ticketLabel}}: {{t.ticketTotalPrice | currency:'EUR'}}
        </p>
      </ng-container>

      <form *ngIf="buyForm" [formGroup]="buyForm">

        <h4 class="m-right-medium m-left-medium">
          {{'Ticket.ClientInformation' | translate}}
        </h4>

        <ion-grid>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.ClientEmail" | translate}}
                </ion-label>
                <ion-input clearInput type="email" formControlName="email" required placeholder="email@something.be">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.VerificationClientEmail" | translate}}
                </ion-label>
                <ion-input clearInput type="email" formControlName="verificationEmail" required
                  placeholder="email@something.be">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.ClientFirstname" | translate}}
                </ion-label>
                <ion-input clearInput type="text" formControlName="firstname" required placeholder="Rosa">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.ClientLastname" | translate}}
                </ion-label>
                <ion-input clearInput type="text" formControlName="lastname" required placeholder="Luxemburg">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label>
                  {{"Ticket.ClientWantPhysicTicket" | translate}}
                </ion-label>
                <ion-toggle slot="end" formControlName="askSendTicket"></ion-toggle>
              </ion-item>
            </ion-col>
          </ion-row>

        </ion-grid>
      </form>
      <ng-container *ngIf="buyForm.value.askSendTicket">
        <form *ngIf="addressForm" [formGroup]="addressForm">
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.ClientStreet" | translate}}
                </ion-label>
                <ion-input clearInput type="text" formControlName="street" required placeholder="Caserne street">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.ClientNumber" | translate}}
                </ion-label>
                <ion-input clearInput type="text" formControlName="number" required placeholder="86">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.ClientPostCode" | translate}}
                </ion-label>
                <ion-input clearInput type="text" formControlName="postCode" required placeholder="1000">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label color="primary" position="stacked">
                  {{"Ticket.ClientCity" | translate}}
                </ion-label>
                <ion-input clearInput type="text" formControlName="city" required placeholder="Brussels">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
        </form>
      </ng-container>
      <ion-button (click)="buy()" [disabled]="disabledBuyButton" color="secondary" expand="block">
        <ion-icon name="cart"></ion-icon>
        {{"Ticket.Pay" | translate}} {{totalAmount | currency:'EUR'}}
      </ion-button>
    </ion-content>

  </ng-container>

</ion-content>